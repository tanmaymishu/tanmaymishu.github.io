<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Undocumented Laravel: Pipelines - Tanmay Mishu</title><meta name=Description content="Tales of a software craftsman"><meta property="og:title" content="Undocumented Laravel: Pipelines"><meta property="og:description" content="Have you ever wanted to perform a series of tasks/operations on an object (or any type of data) and had to manually build up the process yourself? Did you know that you could easily handle such situations with a pattern that is built into the Laravel framework, called “Pipelines”?
If you’re familiar with the concept of middleware, you already know that when a request enters the application, the request is passed through a series of middleware, traveling from the current middleware to the next."><meta property="og:type" content="article"><meta property="og:url" content="https://tanmaymishu.github.io/posts/undocumented-laravel-pipelines/"><meta property="og:image" content="https://tanmaymishu.github.io/banner.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-06T11:33:00+06:00"><meta property="article:modified_time" content="2020-05-06T11:33:00+06:00"><meta property="og:site_name" content="Tanmay Mishu's Website"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tanmaymishu.github.io/banner.png"><meta name=twitter:title content="Undocumented Laravel: Pipelines"><meta name=twitter:description content="Have you ever wanted to perform a series of tasks/operations on an object (or any type of data) and had to manually build up the process yourself? Did you know that you could easily handle such situations with a pattern that is built into the Laravel framework, called “Pipelines”?
If you’re familiar with the concept of middleware, you already know that when a request enters the application, the request is passed through a series of middleware, traveling from the current middleware to the next."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://tanmaymishu.github.io/posts/undocumented-laravel-pipelines/><link rel=prev href=https://tanmaymishu.github.io/posts/undocumented-laravel-macros/><link rel=next href=https://tanmaymishu.github.io/posts/configure-vite-in-a-laravel-project/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Undocumented Laravel: Pipelines","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/tanmaymishu.github.io\/posts\/undocumented-laravel-pipelines\/"},"genre":"posts","keywords":"metaprogramming","wordcount":974,"url":"https:\/\/tanmaymishu.github.io\/posts\/undocumented-laravel-pipelines\/","datePublished":"2020-05-06T11:33:00+06:00","dateModified":"2020-05-06T11:33:00+06:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Tanmay"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Tanmay Mishu">&lt;TANMAY/></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/uses/>Uses </a><a class=menu-item href=/about/>About </a><a class=menu-item href=/portfolio/>Portfolio </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Tanmay Mishu">&lt;TANMAY/></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/uses/ title>Uses</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=/portfolio/ title>Portfolio</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Undocumented Laravel: Pipelines</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Tanmay</a></span>&nbsp;<span class=post-category>included in <a href=/categories/laravel/><i class="far fa-folder fa-fw" aria-hidden=true></i>laravel</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2020-05-06>2020-05-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;974 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;5 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents></nav></div></div><div class=content id=content><p><img class=lazyload src=/svg/loading.min.svg data-src=/pipeline.jpeg#feat data-srcset="/pipeline.jpeg#feat, /pipeline.jpeg#feat 1.5x, /pipeline.jpeg#feat 2x" data-sizes=auto alt=/pipeline.jpeg#feat title=Pipeline></p><p>Have you ever wanted to perform a series of tasks/operations on an object (or any type of data) and had to manually build up the process yourself? Did you know that you could easily handle such situations with a pattern that is built into the Laravel framework, called “Pipelines”?</p><p>If you’re familiar with the concept of middleware, you already know that when a request enters the application, the request is passed through a series of middleware, traveling from the current middleware to the next. Each middleware can be thought of as a pipe.</p><p>In order to get the basic idea about how pipelines work, we have to dig into the source code of Laravel a bit.</p><p>Let’s head over to the App\Http\Kernel class, where all middleware are registered. You’ll notice that this class doesn’t do anything other than containing the middleware. This class extends the parent Illuminate\Foundation\Http\Kernel class. Let’s examine that class.</p><p>In the handle() method of the Illuminate\Foundation\Http\Kernel, you’ll find a call to its sendRequestThroughRouter() method which returns something interesting.</p><p>It first creates an instance of the Pipeline class then passes the $request object to the send() method and conditionally passes an empty array or the middleware array to the through() method. The $request object is passed from one handle() method to another handle() method and finally, as a returned result of the dispatchToRouter() method, a function is passed to the then() method. Eventually, the result of that function call is returned and stored in the $response variable.</p><ul><li>The send() method accepts the data to be passed to each middleware (or pipe).</li><li>The through() method accepts the array of middleware (or pipe) containing a handle() method.</li><li>The then() method accepts a function to be executed when all the operations/tasks are finished.</li></ul><p>Let’s review the syntax one more time:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>// An instance of Pipeline can be obtained from the container
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span><span style=color:#bb60d5>$pipeline</span> <span style=color:#666>=</span> app(Pipeline<span style=color:#666>::</span><span style=color:#4070a0>class</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb60d5>$result</span> <span style=color:#666>=</span> <span style=color:#bb60d5>$pipeline</span><span style=color:#666>-&gt;</span><span style=color:#4070a0>send</span>(<span style=color:#bb60d5>$passable</span>) <span style=color:#60a0b0;font-style:italic>// any type of data
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	<span style=color:#666>-&gt;</span><span style=color:#4070a0>through</span>(<span style=color:#bb60d5>$pipes</span>) <span style=color:#60a0b0;font-style:italic>// array of pipes
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	<span style=color:#666>-&gt;</span><span style=color:#4070a0>then</span>(<span style=color:#007020;font-weight:700>function</span> (<span style=color:#bb60d5>$passable</span>) { <span style=color:#60a0b0;font-style:italic>// function to be executed when finished
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>		<span style=color:#007020;font-weight:700>return</span> <span style=color:#4070a0>&#39;Some Result&#39;</span>;
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div><p>In addition to these methods, a pipeline object has another method called via(). In general, each pipe is expected to conform to one method only, the handle() method. However, if you want to define a different method other than handle(), you should pass the name of the method of your pipe to the via() method:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#bb60d5>$result</span> <span style=color:#666>=</span> <span style=color:#bb60d5>$pipeline</span><span style=color:#666>-&gt;</span><span style=color:#4070a0>send</span>(<span style=color:#bb60d5>$passable</span>) <span style=color:#60a0b0;font-style:italic>// any type of data
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	<span style=color:#666>-&gt;</span><span style=color:#4070a0>through</span>(<span style=color:#bb60d5>$pipes</span>) <span style=color:#60a0b0;font-style:italic>// array of pipes
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	<span style=color:#666>-&gt;</span><span style=color:#4070a0>via</span>(<span style=color:#4070a0>&#39;process&#39;</span>) <span style=color:#60a0b0;font-style:italic>// name of the method in pipe
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	<span style=color:#666>-&gt;</span><span style=color:#4070a0>then</span>(<span style=color:#007020;font-weight:700>function</span> (<span style=color:#bb60d5>$passable</span>) { <span style=color:#60a0b0;font-style:italic>// function to be executed when finished
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>		<span style=color:#007020;font-weight:700>return</span> <span style=color:#4070a0>&#39;Some Result&#39;</span>;
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div><p>Now let&rsquo;s take a look at the signature of the handle() method of a typical pipe:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>DoSomething</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>public</span> <span style=color:#007020;font-weight:700>function</span> <span style=color:#06287e>handle</span>(<span style=color:#bb60d5>$passable</span>, <span style=color:#bb60d5>$next</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#60a0b0;font-style:italic>// Do some heavy-lifting work
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#bb60d5>$next</span>(<span style=color:#bb60d5>$passable</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As you can see, the handle method has two parameters: the data to pass, $passable, and a closure $next, which needs to be called in order for the $passable to travel through the pipes.</p><p>Example:
Enough with the theory, let&rsquo;s take a look at an example. Imagine we have a naive, fictitious order processing system where we need to perform the following tasks when an order is requested:</p><ol><li>Ensure stock availability</li><li>Generate invoice</li><li>Prepare for delivery</li></ol><p>Each of these tasks is a pipe and we need to send the order data through each of these pipes. Our goal is to confirm the order if stock is available and the invoice is generated. Let&rsquo;s take a look at our data class first:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>// Order.php
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span><span style=color:#666>&lt;?</span>php
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>namespace</span> App\Order;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>Order</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>public</span> int <span style=color:#bb60d5>$id</span> <span style=color:#666>=</span> <span style=color:#40a070>42</span>;
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>public</span> bool <span style=color:#bb60d5>$availableInStock</span> <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>false</span>;
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>public</span> bool <span style=color:#bb60d5>$invoiceGenerated</span> <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>false</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In reality, an Order class will be much more complicated than this, but for the sake of brevity, I am keeping it as minimal as possible.</p><p>We will have 3 other classes, each of which is going to represent a pipe:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>// EnsureStockAvailability.php
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#666>&lt;?</span>php
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>namespace</span> App\Order;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>EnsureStockAvailability</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>public</span> <span style=color:#007020;font-weight:700>function</span> <span style=color:#06287e>handle</span>(<span style=color:#bb60d5>$order</span>, <span style=color:#bb60d5>$next</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>if</span> (<span style=color:#bb60d5>$this</span><span style=color:#666>-&gt;</span><span style=color:#4070a0>hasItemsInStock</span>(<span style=color:#bb60d5>$order</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#bb60d5>$order</span><span style=color:#666>-&gt;</span><span style=color:#4070a0>availableInStock</span> <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>true</span>;
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>return</span> <span style=color:#bb60d5>$next</span>(<span style=color:#bb60d5>$order</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#bb60d5>$next</span>(<span style=color:#bb60d5>$order</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>private</span> <span style=color:#007020;font-weight:700>function</span> <span style=color:#06287e>hasItemsInStock</span>(<span style=color:#bb60d5>$order</span>)<span style=color:#666>:</span> bool
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#60a0b0;font-style:italic>// Do some complex calculation with $order
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#007020;font-weight:700>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>// GenerateInvoice.php
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#666>&lt;?</span>php
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>namespace</span> App\Order;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>GenerateInvoice</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>public</span> <span style=color:#007020;font-weight:700>function</span> <span style=color:#06287e>handle</span>(<span style=color:#bb60d5>$order</span>, <span style=color:#bb60d5>$next</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>if</span> (<span style=color:#bb60d5>$this</span><span style=color:#666>-&gt;</span><span style=color:#4070a0>validate</span>(<span style=color:#bb60d5>$order</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#bb60d5>$order</span><span style=color:#666>-&gt;</span><span style=color:#4070a0>invoiceGenerated</span> <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>true</span>;
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>return</span> <span style=color:#bb60d5>$next</span>(<span style=color:#bb60d5>$order</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#bb60d5>$next</span>(<span style=color:#bb60d5>$order</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>private</span> <span style=color:#007020;font-weight:700>function</span> <span style=color:#06287e>validate</span>(<span style=color:#bb60d5>$order</span>)<span style=color:#666>:</span> bool
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#60a0b0;font-style:italic>// Do some complex calculation with $order
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#007020;font-weight:700>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>// PrepareForDelivery.php
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#666>&lt;?</span>php
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>namespace</span> App\Order;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>class</span> <span style=color:#0e84b5;font-weight:700>PrepareForDelivery</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>public</span> <span style=color:#007020;font-weight:700>function</span> <span style=color:#06287e>handle</span>(<span style=color:#bb60d5>$order</span>, <span style=color:#bb60d5>$next</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        info(<span style=color:#4070a0>&#39;Preparing for delivery.&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>return</span> <span style=color:#bb60d5>$next</span>(<span style=color:#bb60d5>$order</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Each of these three classes is pretty self-explanatory. The handle method of EnsureStockAvailability class checks to see if the requested items are available and updates the availableInStock boolean field on $order object if items are available and then passes the $order to the next layer of the pipeline by returning $next($order). If the items are not available, the availableInStock is not updated and holds the default value which is false. Pretty much the same for the GenerateInvoice class. It validates the order and updates the invoiceGenerated boolean field. Finally in PrepareForDelivery&rsquo;s handle method, only a simple text is being logged using the info() helper. Again, in a real-world application, you will probably do much more complex stuff here to actually prepare the order for delivery.</p><p>Now, we need to run the pipeline somewhere. Let&rsquo;s do that in a route:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>// web.php
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#666>&lt;?</span>php
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>use</span> Illuminate\Support\Facades\Route;
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>use</span> App\Order\EnsureStockAvailability;
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>use</span> App\Order\GenerateInvoice;
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>use</span> App\Order\Order;
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>use</span> App\Order\PrepareForDelivery;
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>use</span> Illuminate\Pipeline\Pipeline;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Route<span style=color:#666>::</span><span style=color:#4070a0>get</span>(<span style=color:#4070a0>&#39;/&#39;</span>, <span style=color:#007020;font-weight:700>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#bb60d5>$pipes</span> <span style=color:#666>=</span> [
</span></span><span style=display:flex><span>        EnsureStockAvailability<span style=color:#666>::</span><span style=color:#4070a0>class</span>,
</span></span><span style=display:flex><span>        GenerateInvoice<span style=color:#666>::</span><span style=color:#4070a0>class</span>,
</span></span><span style=display:flex><span>        PrepareForDelivery<span style=color:#666>::</span><span style=color:#4070a0>class</span>,
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>    <span style=color:#bb60d5>$pipeline</span> <span style=color:#666>=</span> app(Pipeline<span style=color:#666>::</span><span style=color:#4070a0>class</span>);
</span></span><span style=display:flex><span>    <span style=color:#bb60d5>$result</span> <span style=color:#666>=</span> <span style=color:#bb60d5>$pipeline</span><span style=color:#666>-&gt;</span><span style=color:#4070a0>send</span>(<span style=color:#007020;font-weight:700>new</span> Order())
</span></span><span style=display:flex><span>        <span style=color:#666>-&gt;</span><span style=color:#4070a0>through</span>(<span style=color:#bb60d5>$pipes</span>)
</span></span><span style=display:flex><span>        <span style=color:#666>-&gt;</span><span style=color:#4070a0>then</span>(<span style=color:#007020;font-weight:700>function</span> (<span style=color:#bb60d5>$order</span>) {
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>return</span> <span style=color:#bb60d5>$order</span><span style=color:#666>-&gt;</span><span style=color:#4070a0>availableInStock</span> <span style=color:#666>&amp;&amp;</span> <span style=color:#bb60d5>$order</span><span style=color:#666>-&gt;</span><span style=color:#4070a0>invoiceGenerated</span>
</span></span><span style=display:flex><span>                <span style=color:#666>?</span> <span style=color:#4070a0>&#34;Order No. </span><span style=color:#70a0d0>$order-&gt;id</span><span style=color:#4070a0> is confirmed.&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#666>:</span> <span style=color:#4070a0>&#34;Order No. </span><span style=color:#70a0d0>$order-&gt;id</span><span style=color:#4070a0> could not be processed.&#34;</span>;
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>return</span> response()<span style=color:#666>-&gt;</span><span style=color:#4070a0>json</span>([<span style=color:#4070a0>&#39;message&#39;</span> <span style=color:#666>=&gt;</span> <span style=color:#bb60d5>$result</span>]);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>If we hit the / route now, we will see a JSON response like below:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#062873;font-weight:700>&#34;message&#34;</span>: <span style=color:#4070a0>&#34;Order No. 42 is confirmed.&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-05-06</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://tanmaymishu.github.io/posts/undocumented-laravel-pipelines/ data-title="Undocumented Laravel: Pipelines" data-via=tanmaymishu data-hashtags=metaprogramming><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://tanmaymishu.github.io/posts/undocumented-laravel-pipelines/ data-hashtag=metaprogramming><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://tanmaymishu.github.io/posts/undocumented-laravel-pipelines/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://tanmaymishu.github.io/posts/undocumented-laravel-pipelines/ data-title="Undocumented Laravel: Pipelines" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://tanmaymishu.github.io/posts/undocumented-laravel-pipelines/ data-title="Undocumented Laravel: Pipelines"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://tanmaymishu.github.io/posts/undocumented-laravel-pipelines/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/metaprogramming/>metaprogramming</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/undocumented-laravel-macros/ class=prev rel=prev title="Undocumented Laravel: Macros"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Undocumented Laravel: Macros</a>
<a href=/posts/configure-vite-in-a-laravel-project/ class=next rel=next title="How to configure Vite with Inertia, React, and TypeScript in a Laravel Project">How to configure Vite with Inertia, React, and TypeScript in a Laravel Project<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=utterances class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Tanmay's Website</div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Tanmay</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{utterances:{darkTheme:"github-dark",issueTerm:"title",label:"comment",lightTheme:"github-light",repo:"tanmaymishu/tanmaymishu.github.io"}}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BG4QB6HTZJ",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-BG4QB6HTZJ" async></script></body></html>